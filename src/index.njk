---
title: ServiceNow Capability Planner
---
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-row">
                <h1>SN Capability Planner</h1>
                <button id="settingsBtn" class="settings-btn">Settings</button>
            </div>
            <div class="legend">
                <div class="legend-item active" data-filter="licensed-high">
                    <span class="legend-box state-licensed-high"></span>
                    <span>High</span>
                </div>
                <div class="legend-item active" data-filter="licensed-medium">
                    <span class="legend-box state-licensed-medium"></span>
                    <span>Medium</span>
                </div>
                <div class="legend-item active" data-filter="licensed-low">
                    <span class="legend-box state-licensed-low"></span>
                    <span>Low</span>
                </div>
                <div class="legend-item active" data-filter="licensed-not-used">
                    <span class="legend-box state-licensed-not-used"></span>
                    <span>Not Used</span>
                </div>
                <div class="legend-item active" data-filter="plan-to-adopt">
                    <span class="legend-box state-plan-to-adopt"></span>
                    <span>Plan</span>
                </div>
                <div class="legend-item active" data-filter="not-licensed">
                    <span class="legend-box state-not-licensed"></span>
                    <span>Not Licensed</span>
                </div>
                <div class="search-filter">
                    <input type="text" id="searchInput" placeholder="Search categories & products..." />
                    <span id="searchClear" class="search-clear" title="Clear search">Ã—</span>
                </div>
            </div>
        </header>

        <main>
            {% set capabilities = capabilities or [] %}
            <div class="categories-grid">
                {% for category in capabilities.categories %}
                <div class="category-card">
                    <div class="category-header">
                        <h2 class="category-title">{{ category.name }}</h2>
                        <button class="add-product-btn" data-category="{{ category.name }}" title="Add product to this category">+</button>
                    </div>
                    <ul class="products-list">
                        {% for product in category.products %}
                        <li class="product-item" 
                            data-state="not-licensed"
                            data-product="{{ product.name }}"
                            data-category="{{ category.name }}"
                            data-tables='{{ product.tables | dump | safe }}'
                            data-description="{{ product.description }}"
                            data-product-url="{{ product.productURL }}"
>
                            <span class="product-name">{{ product.name }}</span>
                            <button class="product-info-btn" title="View details">â„¹</button>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endfor %}
            </div>
        </main>
    </div>

    <!-- Product Details Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2 id="modalProductName"></h2>
            <p id="modalCategory"></p>
            <p id="modalDescription"></p>
            <p id="modalProductURL"></p>
            <div id="modalInstanceLinks" class="instance-links-section">
                <!-- Instance links will be dynamically added here -->
            </div>
            <div id="modalEntitlements" class="entitlements-section">
                <h3>Search Entitlements</h3>
                <div class="entitlements-search">
                    <input type="text" id="entitlementsSearch" placeholder="Search by name or product code...">
                    <span id="entitlementsSearchClear" class="search-clear" title="Clear search">Ã—</span>
                </div>
                <div id="entitlementsResults" class="entitlements-results">
                    <!-- Search results will appear here -->
                </div>
            </div>
            <div id="modalTables">
                <h3>Related Tables:</h3>
                <ul id="tablesList"></ul>
            </div>
            <div class="modal-actions">
                <button id="deleteProductBtn" class="delete-btn">Delete Product</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content modal-large">
            <span class="close-settings">&times;</span>
            <h2>Settings</h2>
            
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" data-tab="export">Export</button>
                <button class="tab-btn" data-tab="import">Import</button>
                <button class="tab-btn" data-tab="reset">Reset</button>
                <button class="tab-btn" data-tab="instance">Instance</button>
                <button class="tab-btn" data-tab="sn-script">ServiceNow Script</button>
                <button class="tab-btn" data-tab="entitlement-schedules">Entitlement Schedules</button>
            </div>
            
            <!-- Export Tab -->
            <div id="export-tab" class="tab-content active">
                <div class="export-section">
                    <h3>Export Capability States</h3>
                    <p>Download your current capability adoption states as JSON. Only includes products that have been changed from the default "Not Licensed" state.</p>
                    <button id="downloadJsonBtn" class="action-btn">Download JSON File</button>
                </div>
                
                <div class="json-viewer-section">
                    <h3>Current State (JSON Preview)</h3>
                    <p id="unmatchedInfo" class="unmatched-info"></p>
                    <textarea id="jsonViewer" readonly></textarea>
                    <button id="copyJsonBtn" class="action-btn">Copy to Clipboard</button>
                </div>
            </div>
            
            <!-- Import Tab -->
            <div id="import-tab" class="tab-content">
                <div class="import-section">
                    <h3>Import Capability States</h3>
                    <p>Upload a JSON file or paste JSON directly to restore capability states. Products not in the current catalog will be preserved for future use.</p>
                    
                    <!-- File Import -->
                    <div class="import-method">
                        <h4>Method 1: Upload File</h4>
                        <input type="file" id="fileInput" accept=".json" style="display: none;">
                        <button id="importJsonBtn" class="action-btn">Choose File to Import</button>
                    </div>
                    
                    <!-- Paste Import -->
                    <div class="import-method">
                        <h4>Method 2: Paste JSON</h4>
                        <textarea id="importTextarea" placeholder="Paste your JSON here..."></textarea>
                        <button id="importFromTextBtn" class="action-btn">Import from Text</button>
                        <button id="clearImportTextBtn" class="action-btn cancel-btn">Clear</button>
                    </div>
                    
                    <p id="importStatus" class="import-status"></p>
                </div>
            </div>
            
            <!-- Reset Tab -->
            <div id="reset-tab" class="tab-content">
                <div class="reset-section">
                    <h3>Reset Data</h3>
                    <p>Reset various aspects of the tool back to their initial state.</p>
                    
                    <div class="reset-option">
                        <h4>Restore Deleted Products</h4>
                        <p>Bring back all preloaded products that you've deleted from the catalog.</p>
                        <button id="resetProductsBtn" class="action-btn">Restore Deleted Products</button>
                        <p id="resetStatus" class="form-status"></p>
                    </div>
                    
                    <div class="reset-option">
                        <h4>Reset All Product States</h4>
                        <p>Reset all products back to "Not Licensed" state. This will clear all your capability adoption data.</p>
                        <button id="resetStatesBtn" class="action-btn danger-btn">Reset All States</button>
                        <p id="resetStatesStatus" class="form-status"></p>
                    </div>
                    
                    <div class="reset-option">
                        <h4>Clear All Data</h4>
                        <p>Complete reset: removes all states, deleted products, custom products, and instance configuration. This cannot be undone!</p>
                        <button id="clearAllDataBtn" class="action-btn danger-btn">Clear All Data</button>
                        <p id="clearAllStatus" class="form-status"></p>
                    </div>
                </div>
            </div>
            
            <!-- Instance Tab -->
            <div id="instance-tab" class="tab-content">
                <div class="instance-section">
                    <h3>ServiceNow Instance Configuration</h3>
                    <p>Configure your ServiceNow instance URL to enable direct links to tables and records from product details.</p>
                    
                    <div class="form-group">
                        <label for="instanceUrl">Instance URL:</label>
                        <input type="text" id="instanceUrl" placeholder="e.g., dev12345 or acme.service-now.com">
                        <small class="help-text">Enter your instance name or URL - we'll figure out the rest!</small>
                        <p id="urlPreview" class="url-preview"></p>
                    </div>
                    
                    <div class="form-actions">
                        <button id="saveInstanceBtn" class="action-btn">Save Instance</button>
                        <button id="clearInstanceBtn" class="action-btn cancel-btn">Clear</button>
                    </div>
                    
                    <p id="instanceStatus" class="form-status"></p>
                    
                    <div class="instance-info">
                        <h4>Current Instance:</h4>
                        <p id="currentInstance" class="current-instance-display">Not configured</p>
                    </div>
                    
                    <div class="instance-help">
                        <h4>Supported Formats (all work the same):</h4>
                        <ul>
                            <li><code>dev12345</code> â†’ https://dev12345.service-now.com</li>
                            <li><code>dev12345.service-now.com</code> â†’ https://dev12345.service-now.com</li>
                            <li><code>https://dev12345.service-now.com</code> â†’ https://dev12345.service-now.com</li>
                            <li><code>http://dev12345.service-now.com</code> â†’ https://dev12345.service-now.com</li>
                            <li><code>acme.servicenowservices.com</code> â†’ https://acme.servicenowservices.com</li>
                            <li><code>www.acme.service-now.com</code> â†’ https://acme.service-now.com</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- ServiceNow Script Tab -->
            <div id="sn-script-tab" class="tab-content">
                <div class="sn-script-section">
                    <h3>ServiceNow Usage Analysis Script</h3>
                    <p>Copy and run this script in your ServiceNow instance (Scripts - Background) to analyze table usage and generate import data.</p>
                    <p class="help-text"><strong>Note:</strong> This script uses GlideAggregate to count records in each table. It categorizes usage as:
                        <span class="usage-category">High (>100 records)</span>,
                        <span class="usage-category">Medium (50-100 records)</span>,
                        <span class="usage-category">Low (1-49 records)</span>, or
                        <span class="usage-category">Not Used (0 records)</span>.
                    </p>
                    
                    <div class="script-actions">
                        <button id="generateScriptBtn" class="action-btn">Generate Script</button>
                        <button id="copyScriptBtn" class="action-btn" style="display: none;">Copy Script</button>
                    </div>
                    
                    <div id="scriptOutput" style="display: none;">
                        <h4>Generated Script:</h4>
                        <pre id="scriptCode" class="script-code"></pre>
                    </div>
                </div>
            </div>
            
            <!-- Entitlement Schedules Tab -->
            <div id="entitlement-schedules-tab" class="tab-content">
                <div class="entitlement-schedules-section">
                    <h3>ServiceNow Entitlement Schedules</h3>
                    <p>Browse official ServiceNow entitlement schedule documentation. These documents define subscription units, managed resource types, and usage ratios for various ServiceNow products.</p>
                    
                    <div class="schedules-search">
                        <input type="text" id="schedulesSearch" placeholder="Search schedules by title...">
                        <span id="schedulesSearchClear" class="search-clear" title="Clear search">Ã—</span>
                    </div>
                    
                    <div class="schedules-list">
                        {% set schedules = collections.entitlementSchedules %}
                        {% if schedules.length > 0 %}
                        <ul class="schedules-items">
                            {% for schedule in schedules %}
                            <li class="schedule-item" data-title="{{ schedule.data.title | lower }}">
                                <div class="schedule-info">
                                    <h4 class="schedule-title">{{ schedule.data.title }}</h4>
                                    {% if schedule.data.pdfUrl %}
                                    <a href="{{ schedule.data.pdfUrl }}" target="_blank" class="schedule-pdf-link" title="Download PDF">
                                        ðŸ“¥ Download PDF
                                    </a>
                                    {% endif %}
                                </div>
                                <a href="{{ schedule.url }}" target="_blank" class="schedule-view-link">View Details â†’</a>
                            </li>
                            {% endfor %}
                        </ul>
                        <p class="schedules-count">Showing <span id="schedulesCount">{{ schedules.length }}</span> of {{ schedules.length }} schedules</p>
                        {% else %}
                        <p class="no-schedules">No entitlement schedules available. Run <code>npm run getEntitlementSchedules</code> to download them.</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="modal-content">
            <span class="close-add-product">&times;</span>
            <h2>Add New Product</h2>
            <form id="addProductForm">
                <div class="form-group">
                    <label for="addProductCategory">Category:</label>
                    <input type="text" id="addProductCategory" readonly>
                </div>
                <div class="form-group">
                    <label for="addProductName">Product Name: <span class="required">*</span></label>
                    <input type="text" id="addProductName" required placeholder="e.g., Custom Integration Tool">
                </div>
                <div class="form-group">
                    <label for="addProductDescription">Description:</label>
                    <input type="text" id="addProductDescription" placeholder="Brief description">
                </div>
                <div class="form-group">
                    <label for="addProductTables">Tables:</label>
                    <input type="text" id="addProductTables" placeholder="e.g., custom_table, sys_custom">
                </div>
                <div class="form-group">
                    <label for="addProductURL">Product URL:</label>
                    <input type="url" id="addProductURL" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label for="addProductState">Initial State:</label>
                    <select id="addProductState">
                        <option value="not-licensed">Not Licensed</option>
                        <option value="plan-to-adopt">Plan to Adopt</option>
                        <option value="licensed-high">Licensed - High Usage</option>
                        <option value="licensed-medium">Licensed - Medium Usage</option>
                        <option value="licensed-low">Licensed - Low Usage</option>
                        <option value="licensed-not-used">Licensed - Not Used</option>
                    </select>
                </div>
                <div class="form-actions">
                    <button type="submit" class="action-btn">Add Product</button>
                    <button type="button" class="action-btn cancel-btn" id="cancelAddProduct">Cancel</button>
                </div>
                <p id="addProductStatus" class="form-status"></p>
            </form>
        </div>
    </div>

    <script>
        // Make entitlements data available to the app
        window.entitlementsData = {{ entitlements | dump | safe }};
    </script>
    <script type="module" src="/js/app.js"></script>
</body>
</html>
